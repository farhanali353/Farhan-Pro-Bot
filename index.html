<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omni-Sync Pro | Farhan Ali</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --green: #00a884; --dark: #111b21; --panel: #202c33; }
        body { margin:0; background:var(--dark); color:white; font-family:sans-serif; display:flex; flex-direction:column; height:100vh; }
        header { background:var(--panel); padding:15px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; }
        #mainContainer { flex:1; display:flex; overflow:hidden; }
        #userList { width:100%; overflow-y:auto; background:var(--dark); }
        .user-card { padding:15px; border-bottom:1px solid #222; cursor:pointer; display:flex; align-items:center; gap:10px; }
        .user-card:hover { background:#2a3942; }
        #chatArea { display:none; flex-direction:column; width:100%; position:fixed; inset:0; background:var(--dark); z-index:10; }
        #messages { flex:1; overflow-y:auto; padding:15px; }
        .msg { background:var(--green); padding:8px 12px; border-radius:10px; margin-bottom:10px; align-self: flex-start; max-width:80%; }
        .img-msg { max-width:100%; border-radius:10px; margin-top:5px; }
        .input-bar { background:var(--panel); padding:10px; display:flex; align-items:center; gap:10px; }
        input[type="text"] { flex:1; padding:10px; border-radius:20px; border:none; outline:none; background:#2a3942; color:white; }
        .icon-btn { cursor:pointer; font-size:20px; }
        .hidden { display:none; }
    </style>
</head>
<body>

<header>
    <div id="headerTitle">Omni-Sync Global</div>
    <div style="font-size:12px; opacity:0.6;">CEO: Farhan Ali</div>
</header>

<div id="mainContainer">
    <div id="userList">
        <p style="text-align:center; padding:20px; color:#8696a0;">Scanning for users...</p>
    </div>
</div>

<div id="chatArea">
    <header>
        <button onclick="closeChat()" style="background:none; border:none; color:white; font-size:20px;">‚Üê</button>
        <b id="activeTarget">User Name</b>
        <div></div>
    </header>
    <div id="messages"></div>
    <div class="input-bar">
        <label class="icon-btn">üìé<input type="file" id="mediaInput" class="hidden" accept="image/*" onchange="uploadMedia()"></label>
        <input type="text" id="msgInput" placeholder="Type a message...">
        <button onclick="sendMsg()" style="background:var(--green); border:none; padding:8px 15px; border-radius:50%; color:white;">‚ûî</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDSBjud7mbGqACBs80582RUy4-A-p_jR70",
        authDomain: "omnisync-92600.firebaseapp.com",
        projectId: "omnisync-92600",
        appId: "1:144024375181:web:073eec8256ed14c46f04c6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let currentUser = "Farhan Ali"; // Aap isay dynamic bhi kar sakte hain
    let chatTarget = "";

    // Global User List
    db.collection("users").onSnapshot(snap => {
        const list = document.getElementById('userList');
        list.innerHTML = "";
        snap.forEach(doc => {
            const u = doc.data();
            const div = document.createElement('div');
            div.className = 'user-card';
            div.innerHTML = `<div style="width:40px;height:40px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;">${u.name[0]}</div> <b>${u.name}</b>`;
            div.onclick = () => openChat(u.name);
            list.appendChild(div);
        });
    });

    function openChat(name) {
        chatTarget = name;
        document.getElementById('activeTarget').innerText = name;
        document.getElementById('chatArea').style.display = 'flex';
        loadMessages();
    }

    function closeChat() { document.getElementById('chatArea').style.display = 'none'; }

    function loadMessages() {
        db.collection("chats").orderBy("time").onSnapshot(snap => {
            const box = document.getElementById('messages');
            box.innerHTML = "";
            snap.forEach(doc => {
                const m = doc.data();
                if((m.from == currentUser && m.to == chatTarget) || (m.from == chatTarget && m.to == currentUser)) {
                    const content = m.type == 'image' ? `<img src="${m.url}" class="img-msg">` : m.text;
                    box.innerHTML += `<div class="msg"><b>${m.from}:</b><br>${content}</div>`;
                }
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    async function uploadMedia() {
        const file = document.getElementById('mediaInput').files[0];
        if(!file) return;
        // ImgBB API for Free Hosting
        let formData = new FormData();
        formData.append("image", file);
        const res = await fetch("https://api.imgbb.com/1/upload?key=YOUR_FREE_API_KEY", { method: "POST", body: formData });
        const data = await res.json();
        if(data.success) {
            db.collection("chats").add({ from: currentUser, to: chatTarget, type: 'image', url: data.data.url, time: Date.now() });
        }
    }

    function sendMsg() {
        const text = document.getElementById('msgInput').value;
        if(!text || !chatTarget) return;
        db.collection("chats").add({ from: currentUser, to: chatTarget, text: text, type: 'text', time: Date.now() });
        document.getElementById('msgInput').value = "";
    }
</script>
</body>
</html>
